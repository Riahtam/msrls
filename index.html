<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Member Insurance Detail-Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: "Inter", sans-serif;
        }

        .table-container {
            overflow-x: auto;
        }

        .table-fixed-header thead th {
            position: sticky;
            top: 0;
            background-color: #f8fafc;
            z-index: 10;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            line-height: 1;
            color: #fff;
            text-align: center;
            white-space: nowrap;
            vertical-align: middle;
            border-radius: 0.375rem;
        }

        .bg-success {
            background-color: #10B981;
        }

        .bg-danger {
            background-color: #EF4444;
        }

        .bg-primary {
            background-color: #3B82F6;
        }

        .bg-warning {
            background-color: #F59E0B;
            color: #1F2937;
        }

        /* --- Mobile Responsive Table Styles --- */
        @media screen and (max-width: 767px) {
            .table-container {
                overflow-x: hidden;
            }

            table,
            thead,
            tbody,
            th,
            td,
            tr {
                display: block;
            }

            thead tr {
                position: absolute;
                top: -9999px;
                left: -9999px;
            }

            tr {
                border: 1px solid #e2e8f0;
                border-radius: 0.5rem;
                margin-bottom: 1rem;
                padding: 0.5rem;
                display: flex;
                flex-direction: column;
                gap: 0.5rem;
            }

            td {
                border: none !important;
                position: relative;
                padding-left: 50% !important;
                text-align: left !important;
                font-size: 0.875rem;
                /* sm:text-sm */
            }

            td::before {
                content: attr(data-label);
                position: absolute;
                left: 0.5rem;
                width: 45%;
                padding-right: 10px;
                white-space: nowrap;
                font-weight: 600;
                color: #4a5568;
            }
        }
    </style>
</head>

<!-- <label for="">sdhf</label>
<input type="date" name="" id="" value="2012-09-01"> -->
<body class="bg-gray-100 min-h-screen p-4 md:p-8">
     <!--  MODAL  FOR uploaded IN LOKOS  -->
    <div class="modal fade" id="exampleModal12" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel12">Insurance Detail</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateInLokosForm">
                        <div class="row">
                            <input type="text" class="form-control rounded-3" id="Mode" name="Mode" required
                                value="UPLOADINLOKOS" readonly style="display:none;">
                                <input type="text" class="form-control rounded-3" id="id12" name="id" required readonly style="display:none;">
                                <input type="text" class="form-control rounded-3" id="ApproveSheet12" name="ApproveSheet" required  readonly style="">
                            <!-- DISPLAY TO USER -->
                            <div class="col-md-4">
                                <label for="MemberName" class="form-label">Member Name <b class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="MemberName12" name="MemberName"
                                    readonly required>
                            </div>
                            <div class="col-md-4">
                                <label for="MemberCode" class="form-label">Member Code <b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="MemberCode12" name="MemberCode"
                                    readonly required>
                            </div>
                            <div class="col-md-4">
                                <label for="SHGCode" class="form-label">SHG Code<b class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="SHGCode12" readonly name="SHGCode"
                                    required>
                            </div>
                            <div class="col-md-12">
                                <label for="SCOde" class="form-label">Security Code<b class="text-danger">*</b></label>
                                <input type="password" class="form-control rounded-3" id="SCOde12" name="SCOde" required>
                            </div>
                        </div>
                        <button type="submit" class="bg-green-800 text-white p-2 mt-3 btn-submit rounded-3"
                            id="updatebtn"> CONFIRM </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!--  MODAL  FOR CONFIRM FROM BLOCK  -->
    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Insurance Detail</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="updateForm">
                        <div class="row">
                            <input type="text" class="form-control rounded-3" id="Mode" name="Mode" required
                                value="APPROVE" readonly style="display:none;">
                                <input type="text" class="form-control rounded-3" id="id" name="id" required readonly style="display:none;">
                                <input type="text" class="form-control rounded-3" id="ApproveSheet" name="ApproveSheet" required  readonly style="display:none;" >

                            <!-- DISPLAY TO USER -->
                            <div class="col-md-4">
                                <label for="MemberName" class="form-label">Member Name <b class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="MemberName" name="MemberName"
                                    readonly required>
                            </div>
                            <div class="col-md-4">
                                <label for="MemberCode" class="form-label">Member Code <b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="MemberCode" name="MemberCode"
                                    readonly required>
                            </div>
                            <div class="col-md-4">
                                <label for="SHGCode" class="form-label">SHG Code<b class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="SHGCode" readonly name="SHGCode"
                                    required>
                            </div>
                            <div class="col-md-12">
                                <label for="SCOde" class="form-label">Security Code<b class="text-danger">*</b></label>
                                <input type="password" class="form-control rounded-3" id="SCOde" name="SCOde" required>
                            </div>
                        </div>
                        <button type="submit" class="bg-green-800 text-white p-2 mt-3 btn-submit rounded-3"
                            id="updatebtn"> CONFIRM </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- UPDATE INSURANCE DETAIL MODAL -->
    <div class="modal fade" id="UPDATEModal" tabindex="-1" aria-labelledby="exampleModalLabel1" aria-hidden="true">
        <div class="modal-dialog modal-xl" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Update Insurance Detail</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="EditForm">
                        <div class="row">
                            <input type="text" class="form-control rounded-3" id="updSheet" name="updSheet" required  readonly  style="display:none;">
                            <input type="text" class="form-control rounded-3" id="Mode" name="Mode" required value="UPDATE" readonly  style="display:none;" >
                            <input type="text" class="form-control rounded-3" id="uid" name="id" required readonly style="display:none;">

                            <!-- DISPLAY TO USER -->
                             <h2 class="m-3"> <b> Pre-Define Member Detail Refers from D01 Report : </b></h2> <br> <br>
                            <div class="col-md-3">
                                <label for="UpdateDistrict" class="form-label">District<b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateDistrict"
                                    name="UpdateDistrict" readonly required>
                            </div>
                            <div class="col-md-3">
                                <label for="UpdateBlock" class="form-label">Block<b class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateBlock" name="UpdateBlock"
                                    readonly required>
                            </div>
                           
                            <div class="col-md-3">
                                <label for="UpdateGP" class="form-label">GP<b class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateGP" name="UpdateGP"
                                   readonly required>
                            </div>

                            <div class="col-md-3">
                                <label for="UpdateVillage" class="form-label">Village<b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateVillage"
                                    name="UpdateVillage" readonly required>
                            </div>
                            <div class="col-md-3">
                                <label for="UpdateMemberName" class="form-label">Member Name<b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateMemberName"
                                    name="UpdateMemberName" readonly required>
                            </div>

                            <div class="col-md-3">
                                <label for="UpdateMemberCode" class="form-label">SHG Member Code<b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateMemberCode"
                                    name="UpdateMemberCode" readonly required>
                            </div>

                            <div class="col-md-3">
                                <label for="UpdateShgName" class="form-label">SHG Name<b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateShgName"
                                    name="UpdateShgName" readonly  required>
                            </div>

                            <div class="col-md-3 mb-4">
                                <label for="UpdateShgCode" class="form-label">SHG Code<b
                                        class="text-danger">*</b></label>
                                <input type="text" class="form-control rounded-3" id="UpdateShgCode"
                                    name="UpdateShgCode" readonly  required>
                            </div>
                            <br> <br>
                            <hr>
                           

                            <h2 class="m-3"> <b>Saving Account Detail </b></h2> <br>
                            <div class="col-md-12">  
                                <label for="MemberHavingSavingAcc" class="form-label">Member Having Saving Bank Account Yes/ No? <b class="text-danger">*</b></label>
                                <select class="form-control" name="MemberHavingSavingAcc" id="MemberHavingSavingAcc">
                                    <option value="Yes">Yes</option> 
                                    <option value="No">No</option> 
                                </select>
                            </div>          

                            <div class="row" id="savingAccdetailrow">
                                <div class="col-md-4">
                                    <label for="UpdateSavingAccountName" class="form-label">Saving Account Name </label>
                                    <input type="text" class="form-control rounded-3" id="UpdateSavingAccountName" name="UpdateSavingAccountName"  maxlength="100" >
                                </div>
                                <div class="col-md-4">
                                    <label for="UpdateSavingAccountNumber" class="form-label">Saving Account Number </label>
                                    <input type="text" class="form-control rounded-3" id="UpdateSavingAccountNumber"
                                        name="UpdateSavingAccountNumber" maxlength="12">
                                </div>
                                <div class="col-md-4">
                                    <label for="UpdateSavingBranchName" class="form-label">Saving Branch Name </label>
                                    <input type="text" class="form-control rounded-3" id="UpdateSavingBranchName"
                                        name="UpdateSavingBranchName" maxlength="100">
                                </div>
                                <div class="col-md-4 mb-4">
                                    <label for="UpdateSavingIFSCCode" class="form-label">Saving Branch IFSC Code </label>
                                    <input type="text" class="form-control rounded-3" id="UpdateSavingIFSCCode"
                                        name="UpdateSavingIFSCCode" maxlength="10">
                                </div>
                            </div>
                            <!-- <hr> -->
                        </div>

                        <h2 class="m-3"> <b> Insurance Detail </b></h2>

                        <div class="row">
                            <!-- Member enroll in any insurance -->
                            <div class="col-md-12">
                                <label for="MemberEnrollInInsurance" class="form-label">Member Enroll in Any Insurance Yes/No? <b class="text-danger">*</b></label>
                                <select class="form-control" name="MemberEnrollInInsurance" id="MemberEnrollInInsurance" required>
                                    <option value="YES">YES</option>
                                    <option value="NO">NO</option>
                                </select>
                            </div>
                        </div>

                        <!-- to show only if they have insurance -->
                        <div class="row" id="insuranceDetailrow" >
                            <!-- <h2 class="m-3"> <b> Insurance Detail </b></h2>  -->
                            <!-- PMSBY -->
                            <div class="col-md-4"> 
                                <label for="UpdateEnrollPMSBY" class="form-label">Enroll in PMSBY Yes/No? </label>
                                <select class="form-control" name="UpdateEnrollPMSBY" id="UpdateEnrollPMSBY" >
                                    <option value="YES">YES</option>
                                    <option value="NO">NO</option>
                                </select>
                                <!-- <input type="text" class="form-control rounded-3" id="UpdateEnrollPMSBY" name="UpdateEnrollPMSBY" required> -->
                            </div>
                            <div class="col-md-4">
                                <label for="UpdatePMSBYEnrollDate" class="form-label"> PMSBY Enrollment Date </label>
                                <input type="date" class="form-control rounded-3" id="UpdatePMSBYEnrollDate"
                                    name="UpdatePMSBYEnrollDate" >
                            </div>

                            <div class="col-md-4">
                                <label for="PMSBYPolicyNumber" class="form-label"> PMSBY Policy Number </label>
                                <input type="text" class="form-control rounded-3" id="PMSBYPolicyNumber"
                                    name="PMSBYPolicyNumber">
                            </div>

                            <!-- PMJJBY -->
                            <div class="col-md-4">
                                <label for="UpdateEnrollPMJJBY" class="form-label">Enroll in PMJJBY? </label>
                                <select class="form-control" name="UpdateEnrollPMJJBY" id="UpdateEnrollPMJJBY">
                                    <option value="Yes">Yes</option>
                                    <option value="Yes">No</option>
                                </select>
                                <!-- <input type="text" class="form-control rounded-3" id="UpdateEnrollPMJJBY" name="UpdateEnrollPMJJBY" required> -->
                            </div>
                            <div class="col-md-4">
                                <label for="UpdatePMJJBYEnrollDate" class="form-label">PMJJBY Enrollment Date </label>
                                <input type="date" class="form-control rounded-3" id="UpdatePMJJBYEnrollDate"
                                    name="UpdatePMJJBYEnrollDate" >
                            </div>

                            <div class="col-md-4">
                                <label for="PMJJBYPolicyNumber" class="form-label">PMJJBY Policy Number </label>
                                <input type="text" class="form-control rounded-3" id="PMJJBYPolicyNumber"
                                    name="PMJJBYPolicyNumber">
                            </div>

                            <!-- PMJAY -->
                            <div class="col-md-4">
                                <label for="UpdateEnrollPMJAY" class="form-label">Enroll in PMJAY? </label>
                                <select class="form-control" name="UpdateEnrollPMJAY" id="UpdateEnrollPMJAY">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                                <!-- <input type="text" class="form-control rounded-3" id="UpdateEnrollPMJAY" name="UpdateEnrollPMJAY" required> -->
                            </div>
                            <div class="col-md-4">
                                <label for="UpdatePMJAYEnrollDate" class="form-label">PMJAY Enrollment Date </label>
                                <input type="date" class="form-control rounded-3" id="UpdatePMJAYEnrollDate"
                                    name="UpdatePMJAYEnrollDate" >
                            </div>
                            <div class="col-md-4">
                                <label for="PMJAYPolicyNumber" class="form-label">PMJAY Policy Number </label>
                                <input type="text" class="form-control rounded-3" id="PMJAYPolicyNumber"
                                    name="PMJAYPolicyNumber" >
                            </div>

                            <!-- APY -->
                            <div class="col-md-4">
                                <label for="UpdateEnrollAPY" class="form-label">Enroll in APY? </label>
                                <select class="form-control" name="UpdateEnrollAPY" id="UpdateEnrollAPY">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                                <!-- <input type="text" class="form-control rounded-3" id="UpdateEnrollAPY"  name="UpdateEnrollAPY" required> -->
                            </div>
                            <div class="col-md-4">
                                <label for="UpdateAPYEnrollDate" class="form-label">APY Enrollment Date </label>    
                                <input type="date" class="form-control rounded-3" id="UpdateAPYEnrollDate"
                                    name="UpdateAPYEnrollDate" >
                            </div>
                            <div class="col-md-4">
                                <label for="APYPolicyNumber" class="form-label">APY Policy Number ></label>
                                <input type="text" class="form-control rounded-3" id="APYPolicyNumber"
                                    name="APYPolicyNumber" >
                            </div>

                            <!-- OTHER LIFE Insurance -->
                            <div class="col-md-4">
                                <label for="UpdateEnrollOtherLI" class="form-label">Enroll in Other Life Insurance </label>
                                <select class="form-control" name="UpdateEnrollOtherLI" id="UpdateEnrollOtherLI">
                                    <option value="Yes">Yes</option>
                                    <option value="No">No</option>
                                </select>
                                <!-- <input type="text" class="form-control rounded-3" id="UpdateEnrollOtherLI"  name="UpdateEnrollOtherLI" required> -->
                            </div>


                            <div class="col-md-4">
                                <label for="UpdateOLIName" class="form-label">Insurance Enrollment Name </label>
                                <input type="text" class="form-control rounded-3" id="UpdateOLIName"
                                    name="UpdateOLIName" >
                            </div>

                            <div class="col-md-4">
                                <label for="UpdateOLIEnrollDate" class="form-label">Other Life Insurance Enrollment Date </label>
                                <input type="date" class="form-control rounded-3" id="UpdateOLIEnrollDate"
                                    name="UpdateOLIEnrollDate" >
                            </div>
                            <div class="col-md-4">
                                <label for="LIPolicyNumber" class="form-label">Other Life Insurance Policy Number </label>
                                <input type="text" class="form-control rounded-3" id="LIPolicyNumber"
                                    name="LIPolicyNumber" >
                            </div>
                        </div>
                        <div class="col-md-12">
                            <label for="SCOde" class="form-label">Security Code<b class="text-danger">*</b></label>
                            <input type="password" class="form-control rounded-3" id="SCOde" name="SCOde" required>
                        </div>

                        <button type="submit" class="bg-green-800 text-white p-2 mt-3 btn-submit rounded-3" id="updatebtn"> UPDATE </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- END MODAL -->


    <div class="bg-white p-4 md:p-8 rounded-lg shadow-xl">
        <!-- <a class="btn btn-info" href="https://forms.gle/LWRXSvdbFhyE4isFA" target="_blank">Continue to Form</a> -->
        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">East Khasi Hills Member Insurance Detail</h1>
        <label for="BlockforLoaddta">Block</label>
        <select name=""  class="form-control" id="BlockforLoaddta">
            <option value="12 Shnong-Laitkroh">12 Shnong-Laitkroh</option>
            <option value="Mawsynram">Mawsynram</option>
            <option value="Mawphlang">Mawphlang</option>
            <option value="Pynursla">Pynursla</option>
            <option value="Sohiong">Sohiong</option>
            <option value="Mylliem">Mylliem</option>
            <option value="Mawryngkneng">Mawryngkneng</option>
            <option value="shella">Shella</option>
            <option value="Mawkynrew">Mawkynrew</option>
            <option value="Mawpat">Mawpat</option>
            <option value="Mawlai">Mawlai</option>
        </select>
        <br><br>

        <!-- option to select  -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 mb-6 items-end">
            <div class="col-span-full lg:col-span-2">
                <label for="searchInput" class="block text-sm font-medium text-gray-700 mb-1">Search...</label>
                <input type="text" id="searchInput" placeholder="Search..."
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
            </div>
            
            <!-- <div>
                <label for="sectorNameFilter" class="block text-sm font-medium text-gray-700 mb-1">Sector Name</label>
                <select id="sectorNameFilter" class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="">All Sector</option>
                </select>
            </div> -->

            <!-- <div>
                <label for="districtFilter" class="block text-sm font-medium text-gray-700 mb-1">District</label>
                <select id="districtFilter"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="">All District</option>
                </select>
            </div> -->

            <div> 
                <label for="blockFilter" class="block text-sm font-medium text-gray-700 mb-1">Block</label>
                <select id="blockFilter"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="">Block</option>
                </select>
            </div>
             <div>
                <label for="GPFilter" class="block text-sm font-medium text-gray-700 mb-1">GP</label>
                <select id="GPFilter"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="">GP</option>
                </select>
            </div> 
            <div>
                <label for="villageFilter" class="block text-sm font-medium text-gray-700 mb-1">Village</label>
                <select id="villageFilter"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="">Village</option>
                </select>
            </div>

            <!-- button -->
            <div>
                <!-- <button class="btn btn-primary" id="searchDatabtn" >Search</button> -->
                <!-- <label for="districtFilter" class="block text-sm font-medium text-gray-700 mb-1">District</label> -->
                <!-- <select id="districtFilter"
                    class="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    <option value="">All District</option>
                </select> -->
            </div>

            <div class="flex items-end gap-4 col-span-full md:col-span-2 lg:col-span-1 justify-between md:justify-end">
                <div>
                    <label for="showEntries" class="block text-sm font-medium text-gray-700 mb-1">Show</label>
                    <select id="showEntries"
                        class="mt-1 p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                <button id="resetBtn"
                    class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-md shadow-sm transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-opacity-75">
                    Reset
                </button>
            </div>
        </div>

        <div class="flex justify-between items-center mb-4 flex-wrap gap-2">
            <button id="downloadExcelBtn"
                class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-75">
                Download Excel
            </button>
            <div class="text-sm text-gray-600">
                Last updated: <span id="lastUpdated">Fetching...</span>
            </div>
        </div>

        <center>
            <span class="text-success h1" id="msg"></span>
            <span class="text-danger h1" id="errormsg"></span>
        </center>

        <div class="table-container bg-white rounded-lg overflow-hidden shadow-md overflow-x-auto">
            <table id="meetingTable" class="min-w-full divide-y divide-gray-200 table-fixed-header">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            SL</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            District</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Block</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            GP</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Village</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Member Name</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            SHG Member Code</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            SHG Name</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            SHG Code</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Member having Saving Bank Account?</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Saving Account Name</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Saving Account Number</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Saving Branch Name</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Saving Bank IFSC Code </th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Member Having any Insurance, Yes/No ? </th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-4">
                            Member Enroll in PMSBY? </th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            PMSBY Enrollment Date</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            PMSBY Policy Number</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Member Enroll in PMJJBY</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            PMJJBY Enrollment Date </th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            PMJJBY Policy Number</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            Member Enroll in PMJAY</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            PMJAY Enrollment Date</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-8">
                            PMJAY Policy Number</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Member Enroll in APY</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            APY Enrollment Date </th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            APY Policy Number</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Member Enroll in Other Life Insurance</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Insurance Name</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Enrollment Date </th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Policy Number</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Confirm from Block(BFS/BMIS) Yes/No?</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Uploaded in Lokos(Yes/No)?</th>
                        <th class="py-3 px-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-10">
                            Confirmation Status</th>
                    </tr>
                </thead>
                <tbody id="meetingTableBody" class="bg-white divide-y divide-gray-200">
                    <tr>
                        <td colspan="14" class="py-4 px-4 text-center text-gray-500">Loading data...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div class="flex flex-col md:flex-row justify-between items-center mt-6 text-sm text-gray-700">
            <div class="mb-2 md:mb-0">
                Total Entries: <span id="totalEntries">0</span>
            </div>
            <div class="flex items-center space-x-4">
                <button id="prevBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 disabled:opacity-50 disabled:cursor-not-allowed">
                    Previous
                </button>
                <span id="pageInfo">Page 1 of 1</span>
                <button id="nextBtn"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md shadow-md transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-opacity-75 disabled:opacity-50 disabled:cursor-not-allowed">
                    Next
                </button>
            </div>
        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <!-- Bootstrap Bundle with Popper (required for Bootstrap's JavaScript components like modals) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        xintegrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script>


        const WEB_APP_URL="https://script.google.com/macros/s/AKfycbwiLCnT_m3iUQrAXho1cfufH0pRE-w834hGKFkdHL05VbR68HJoCRAE1aILWY0TNfMo/exec"
        let allMeetingData = [];
        
        //this  variable will store the data of the district, block, gp and village 
        let dta=[];

        let filteredData = [];
        let currentPage = 1;
        let itemsPerPage = 10;

        // Get DOM elements
        const meetingTableBody = document.getElementById('meetingTableBody');
        const searchInput = document.getElementById('searchInput');
        // filter 
        const DistrictFilter = document.getElementById('DistrictFilter');
        const blockFilter = document.getElementById('blockFilter'); 
        const GPFilter = document.getElementById('GPFilter');
        const villageFilter = document.getElementById('villageFilter');

        // const statusFilter = document.getElementById('statusFilter');
        const showEntries = document.getElementById('showEntries');
        const resetBtn = document.getElementById('resetBtn');
        const downloadExcelBtn = document.getElementById('downloadExcelBtn');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const pageInfo = document.getElementById('pageInfo');
        const totalEntriesSpan = document.getElementById('totalEntries');
        const lastUpdatedSpan = document.getElementById('lastUpdated');

        //############################## function to get data (State, district, block, gp and village) ##################################

        $("#BlockforLoaddta").change(function(){
            fetchData();
        })

        async function fetchData() {
            try {
                const webAppUrl = "https://script.google.com/macros/s/AKfycbzqYYxtRMMUuZQGgr1bY2Gtzj4ghE4cnYspRXNFXSzTJBHOg9GEEt1FzU_n8iDSa9y3/exec";
                let nameParam =$("#BlockforLoaddta").val();
                const apiUrl = `${webAppUrl}?s=${encodeURIComponent(nameParam)}`;
                const response = await fetch(apiUrl);
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}. Response: ${errorText}`);
                }
                const rawData = await response.json();

                if (rawData.message && rawData.message.length > 1) {
                    const headers = rawData.message[0];
                    dta = rawData.message.slice(1).map(row => {
                        const rowObject = {};
                        headers.forEach((header, index) => {
                            rowObject[header] = row[index];
                        });
                        return rowObject;
                    });

                    allMeetingData=dta;
                } else {
                    dta = [];
                    allMeetingData = [];
                    console.warn("No data or headers found in the fetched response.");
                }

                initializeFilters();
                applyFiltersAndSearch();
                const now = new Date();
                lastUpdatedSpan.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

            } catch (error) {
                console.error("Fetch error:", error);
                meetingTableBody.innerHTML = '<tr><td colspan="14" class="py-4 px-4 text-center text-red-500">Error loading data. Please try again.</td></tr>';
                lastUpdatedSpan.textContent = 'Failed to load';
            }
        }


        //  ###################   function to  get the  DETAIL DATA    #######################
        // async function fetchdDetailData() 
        // {
            
        //     if($("#blockFilter").val()=="")
        //     {
        //         console.log("please select Block");
        //         return 0; 
        //     }
        //     if($("#GPFilter").val()=="")
        //     {
        //         console.log("please select GP");
        //         return 0; 
        //     }
        //     if($("#villageFilter").val()=="")
        //     {
        //         console.log("please select Village");
        //         return 0; 
        //     }
           
        //     //console.log("success")
        //         // console.log($("#villageFilter").val());
        //         // console.log($("#GPFilter").val());
        //         // console.log($("#blockFilter").val());

        //     try {

        //         const webAppUrl ="https://script.google.com/macros/s/AKfycby0kWy5sVHDo9JEkBGGhNoV8-fQ89KsD1b7T6ymZnWVBhQl4YvzscxMLBCj7YzLe82C/exec";

        //         const Block = $("#villageFilter").val();
        //         const GP = $("#GPFilter").val();
        //         const Village = $("#blockFilter").val();
        //         const apiUrl = `${webAppUrl}?Block=${encodeURIComponent(Block)}&GP=${encodeURIComponent(GP)}&Village=${encodeURIComponent(Village)}`;
        //         const response = await fetch(apiUrl);
                
        //         if (!response.ok) {
        //             const errorText = await response.text();
        //             throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}. Response: ${errorText}`);
        //         }
        //         const rawData = await response.json();
        //         if (rawData.message && rawData.message.length > 1) {
        //             const headers = rawData.message[0];
        //             allMeetingData = rawData.message.slice(1).map(row => {
        //                 const rowObject = {};
        //                 headers.forEach((header, index) => {
        //                     rowObject[header] = row[index];
        //                 });

        //                 return rowObject;
        //             });
        //         } else {
        //             allMeetingData = [];
        //             console.warn("No data or headers found in the fetched response.");
        //         }
        //         applyFiltersAndSearch();
        //         const now = new Date();
        //         lastUpdatedSpan.textContent = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });

        //     } catch (error) {
        //         console.error("Fetch error:", error);
        //         meetingTableBody.innerHTML = '<tr><td colspan="14" class="py-4 px-4 text-center text-red-500">Error loading data. Please try again.</td></tr>';
        //         lastUpdatedSpan.textContent = 'Failed to load';
        //     }
        // }


    const getUniqueValues = (data, key) => [...new Set(data.map(item => item[key]).filter(Boolean))].sort();
    const populateSelect = (selectElement, values) => {
        selectElement.innerHTML = '<option value="">-- select option -- </option>';
        values.forEach(value => {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = value;
            selectElement.appendChild(option);
        });
    };

function initializeFilters() {
    const allBlocks = getUniqueValues(dta, 'Block');
    populateSelect(blockFilter, allBlocks);
    populateSelect(GPFilter, []);
    populateSelect(villageFilter, []);
}

blockFilter.addEventListener('change', () => {
    const selectedBlock = blockFilter.value;
    const filteredByBlock = dta.filter(item => item.Block === selectedBlock);
    const uniqueGPs = getUniqueValues(filteredByBlock, 'GP');
    populateSelect(GPFilter, uniqueGPs);
    populateSelect(villageFilter, []);
});

GPFilter.addEventListener('change', () => {
    const selectedGP = GPFilter.value;
    const selectedBlock = blockFilter.value; 
    const filteredByGP = dta.filter(item => item.Block === selectedBlock && item.GP === selectedGP);
    const uniqueVillages = getUniqueValues(filteredByGP, 'Village');
    populateSelect(villageFilter, uniqueVillages);
});
        function renderTable() {
            meetingTableBody.innerHTML = '';
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = filteredData.slice(startIndex, endIndex);
            if (paginatedData.length === 0) {
                const row = meetingTableBody.insertRow();
                const cell = row.insertCell();
                cell.colSpan = 14; // Updated colspan to match number of columns
                cell.textContent = "No records found.";
                cell.className = "py-4 px-4 text-center text-gray-500";
                return;
            }
            paginatedData.forEach((item, index) => {
                const row = meetingTableBody.insertRow();
                row.className = 'hover:bg-gray-50'; // Add hover effect
                const uid = item["U_ID"]; // Unique ID  U_ID
                const slNo = startIndex + index + 1; // Serial number
                const district12 = item["District"] || '<span class="badge bg-warning">N/A </span>';
                const block12 = item["Block"] || '<span class="badge bg-warning">N/A </span>';
                const Gp12 = item["GP"] || '<span class="badge bg-warning">N/A </span>';
                const village12 = item["Village"] || '<span class="badge bg-warning">N/A </span>';
                //member name & member code
                const MemberName12 = item["Member Name"] || '<span class="badge bg-warning">N/A </span>';
                const SHGMemberCode12 = item["Member Code"] || '<span class="badge bg-warning">N/A </span>'; 
                //SHG Name & Code
                const SHGName12 = item["SHG Name"] || '<span class="badge bg-warning">N/A </span>';
                const SHGCode12 = item["SHG Code"] || '<span class="badge bg-warning">N/A </span>';
                // member having saving Account
                const MemberHavingSavingAcc12 = item["MemberHavingSavingAcc"] || '<span class="badge bg-warning">N/A </span>';
                const SavingAccNumber12 = item["Saving Account Number"] || '<span class="badge bg-warning">N/A </span>';
                const SavingBankName12 = item["Saving Bank Name"] || '<span class="badge bg-warning">N/A </span>';
                const SavingBranchName12 = item["Saving Branch Name"] || '<span class="badge bg-warning">N/A </span>';
                const SavingIFSCCode12 = item["Saving IFSC Code"] || '<span class="badge bg-warning">N/A </span>';

                const MhavigINsurance12= item['MemberHavingInsurance'] || '<span class="badge bg-warning">N/A </span>';
                //PMSBY
                const PmsbyInsurance12 = item["Member  Enrolled in  PMSBY (Yes /No)"] || '<span class="badge bg-warning">N/A </span>';
                const dateObject = new Date(item["PMSBY Enrollment Date"]);
                const PMSBYEnrollmentDate12 = isNaN(dateObject.getTime()) ? '<span class="badge bg-warning">N/A </span>' : dateObject.toLocaleDateString();
                const PMSBYPolicyNumber = item["PMSBY Policy Number"] || '<span class="badge bg-warning">N/A </span>';
                //PMJJBY
                const PmjjbyInsurance12 = item["Member Enrolled in PMJJBY Insurance (Yes / No)"] || '<span class="badge bg-warning">N/A </span>';
                const dateObject1 = new Date(item["PMJJBY Enrollment Date"]);
                const PMJJBYEnrollmentDate12 = isNaN(dateObject1.getTime()) ? '<span class="badge bg-warning">N/A </span>' : dateObject1.toLocaleDateString();
                const PMJJBYPolicyNumber = item["PMJJBY Policy Number"] || '<span class="badge bg-warning">N/A </span>';
                //PMJAY
                const PmjayInsurance12 = item["Member Enrolled in PMJAY Insurance(Yes / No)"] || '<span class="badge bg-warning">N/A </span>';
                const dateObject2 = new Date(item["PMJAY Enrollment Date"]);
                const PMJAYEnrollmentDate12 = isNaN(dateObject2.getTime()) ? '<span class="badge bg-warning">N/A </span>' : dateObject2.toLocaleDateString();
                const PMJAYPolicyNumber = item["PMJAY Policy Number"] || '<span class="badge bg-warning">N/A </span>';
                //APY
                const apyInsurance12 = item["Member Enrolled in APY Insurance(Yes/No)"] || '<span class="badge bg-warning">N/A </span>';
                const dateObject3 = new Date(item["APY Enrollment Date"]);
                const APYEnrollmentDate12 = isNaN(dateObject3.getTime()) ? '<span class="badge bg-warning">N/A </span>' : dateObject3.toLocaleDateString();
                const APYPolicyNumber = item["APY Policy Number"] || '<span class="badge bg-warning">N/A </span>';
                //OTHERS
                const OtherInsurance12 = item["Other Life Insurance Detail (PLI/LIC/Others) (Yes/No)"] || '<span class="badge bg-warning">N/A </span>';
                const OtherLICInsuranceName = item["Other Insurance"] || '<span class="badge bg-warning">N/A </span>';
                const dateObject4 = new Date(item["Other  Enrollment Date"]);
                const OtherLICEnrollmentDate12 = isNaN(dateObject4.getTime()) ? '<span class="badge bg-warning">N/A </span>' : dateObject4.toLocaleDateString();
                const OtherLICPolicyNumber = item["Other Policy Number"] || '<span class="badge bg-warning">N/A </span>';

                const BlockConfirmation = item["BFS/BMIS Confirmation(Yes/No)"] || '<span class="badge bg-warning">No</span>';
                const uploadedinLokos = item["upload in Lokos"] || '<span class="badge bg-warning">No</span>';

                let approvedByBPM = item["BFS/BMIS Confirmation(Yes/No)"];
                if (approvedByBPM === 'Yes') {
                    c10 = '<span class="badge bg-success"> Confirmed </span>';
                    if(uploadedinLokos==="Yes")
                    {
                        c11="";
                    }
                    else{
                    c11 = `<button type="button" class="btn btn-sm btn-primary mt-1" onclick="uploadinLOkosBtn(${uid})">UploadInlokos</button>`;
                    }
                }
                else {
                    c11 = `<button type="button" class="btn btn-sm btn-primary mt-1" onclick="updatefun(${uid})">EDIT</button>`;
                    c10=`<button type="button" class="btn btn-sm btn-primary mt-1" onclick="edit(${uid})">Confirm</button>`;
                }
                
                row.innerHTML = `
                    <td class="py-2 px-2 whitespace-nowrap text-sm font-medium text-gray-900 w-8" data-label="SL">${slNo}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Sector Name">${district12}</td>
                    <td class="py-2 px-2 whitespace-nowrap text-sm text-gray-700" data-label="Meeting Date">${block12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700 w-8" data-label="Topic">${Gp12}</td>
                    <td class="py-2 px-2 whitespace-nowrap text-sm text-gray-700 w-8" data-label="Meeting Type">${village12}</td>
                    <td class="py-2 px-2 whitespace-nowrap text-sm text-gray-700" data-label="Start Time">${MemberName12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Mode">${SHGMemberCode12}</td>
                    <td class="py-2 px-2 whitespace-nowrap text-sm text-gray-700" data-label="End Time">${SHGName12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Mode">${SHGCode12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Mode">${MemberHavingSavingAcc12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${SavingBankName12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${SavingAccNumber12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${SavingBranchName12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${SavingIFSCCode12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${MhavigINsurance12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${PmsbyInsurance12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${PMSBYEnrollmentDate12}  </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${PMSBYPolicyNumber} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${PmjjbyInsurance12}</td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact Person">${PMJJBYEnrollmentDate12}  </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact Person"> ${PMJJBYPolicyNumber} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${PmjayInsurance12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${PMJAYEnrollmentDate12}  </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${PMJAYPolicyNumber} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${apyInsurance12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${APYEnrollmentDate12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${APYPolicyNumber} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${OtherInsurance12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No."> ${OtherLICInsuranceName} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${OtherLICEnrollmentDate12} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${OtherLICPolicyNumber} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="Contact No.">${BlockConfirmation} </td>
                    <td class="py-2 px-2 text-sm text-gray-700" data-label="uploadedInLokos.">${uploadedinLokos} </td>
                    <td>  ${c10}  <br> ${c11} </td> `;

            });

            updatePaginationInfo();
        }

        function applyFiltersAndSearch() {

            let data = [...allMeetingData]; // Start with a fresh copy of all data
            const searchTerm = searchInput.value.toLowerCase().trim();
            const selectedblock = blockFilter.value;
            const selectedVill = villageFilter.value;

            // Apply search filter
            if (searchTerm) {
                data = data.filter(item =>
                    Object.values(item).some(value =>
                        String(value).toLowerCase().includes(searchTerm)
                    )
                );
            }

            if (selectedblock) {
                data = data.filter(item => item["Block"] === selectedblock);
            }
            if (selectedVill) {
                data = data.filter(item => item["Village"] === selectedVill);
            }
            filteredData = data;
            currentPage = 1;
            renderTable();
        }

        function updatePaginationInfo() {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            pageInfo.textContent = `Page ${currentPage} of ${totalPages || 1}`;
            totalEntriesSpan.textContent = filteredData.length;
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages || totalPages === 0;
        }

        // Search input
        searchInput.addEventListener('keyup', applyFiltersAndSearch);
        blockFilter.addEventListener('change', applyFiltersAndSearch);
        villageFilter.addEventListener('change', applyFiltersAndSearch);

        showEntries.addEventListener('change', (event) => {
            itemsPerPage = parseInt(event.target.value, 10);
            applyFiltersAndSearch();
        });

        // Reset button
        resetBtn.addEventListener('click', () => {
            searchInput.value = '';
            // sectorNameFilter.value = '';
            districtFilter.value = '';
            blockFilter.value = '';
            villageFilter.value = '';
            showEntries.value = '10';
            itemsPerPage = 10;
            applyFiltersAndSearch();
        });

        // Pagination buttons
        prevBtn.addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                renderTable();
            }
        });

        nextBtn.addEventListener('click', () => {
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);
            if (currentPage < totalPages) {
                currentPage++;
                renderTable();
            }
        });

        downloadExcelBtn.addEventListener('click', () => {
            if (filteredData.length === 0) {
                alert("No data to export!");
                return;
            }

            // Header Set_up for excell
            const exportHeaders = [
                "#Sl.No", "District", "Block", "GP", "Village", "Member Name", "SHG Member Code", "SHG Name", "SHG Code",
                "Member Having Saving Bank Account?", "Saving Account Name", "Saving Account Number", "Saving Branch Name", "Saving Bank IFSC Code", "Member Enroll in any Insurance Yes/No", "Member Enrolled in PMSBY?", "PMSBY Enrollment Date", "PMSBY Policy Number", "Member Enrolled in PMJJBY?",
                "PMJJBY Enrollment Date", "PMJJBY Policy Number", "Member Enrolled in PMJAY", "PMJAY Enrollment Date", "PMJAY Policy Number", "Member Enrolled in APY", "APY Enrollment Date", "APY Policy Number",
                "Member Enrolled in Other Life Insurance(PLI/LIC/Others)", "Other Insurance Name", "Enrollmemt Date", "Policy Number", "BFS/BMIS Confirmation(Yes/No)", "upload in Lokos(Yes/No)"
            ];

            const exportData = filteredData.map((item, index) => {
                const row = {};
                row["#Sl.No"] = index + 1;
                row["District"] = item["District"];
                row["Block"] = item["Block"];
                row["GP"] = item["GP"];
                row["Village"] = item["Village"];
                row["Member Name"] = item["Member Name"];
                row["SHG Member Code"] = item["Member Code"];
                row["SHG Name"] = item["SHG Name"];
                row["SHG Code"] = item["SHG Code"];
                row["Member Having Saving Bank Account?"] = item["MemberHavingSavingAcc"];   
                row["Saving Account Name"] = item["Saving Bank Name"];
                row["Saving Account Number"] = item["Saving Account Number"];
                row["Saving Branch Name"] = item["Saving Branch Name"];
                row["Saving Bank IFSC Code"] = item["Saving IFSC Code"];
                row["Member Enroll in any Insurance Yes/No"] = item["MemberHavingInsurance"]
                row["Member Enrolled in PMSBY?"] = item["Member  Enrolled in  PMSBY (Yes /No)"];
                let dateObject = new Date(item["PMSBY Enrollment Date"]);   
                let PMSBYEDate13 = isNaN(dateObject.getTime()) ? ' ' : dateObject.toLocaleDateString();
                row["PMSBY Enrollment Date"] = PMSBYEDate13;
                //row["PMSBY Enrollment Date"] = item["PMSBY Enrollment Date"];
                row["PMSBY Policy Number"] = item["PMSBY Policy Number"];
                row["Member Enrolled in PMJJBY?"] = item["Member Enrolled in PMJJBY Insurance (Yes / No)"];
                let dateObject1 = new Date(item["PMJJBY Enrollment Date"]);
                let PMJJBYEDate13 = isNaN(dateObject1.getTime()) ? ' ' : dateObject1.toLocaleDateString();
                row["PMJJBY Enrollment Date"] = PMJJBYEDate13;
                //row["PMJJBY Enrollment Date"] = item["PMJJBY Enrollment Date"];
                row["PMJJBY Policy Number"] = item["PMJJBY Policy Number"];
                row["Member Enrolled in PMJAY"] = item["Member Enrolled in PMJAY Insurance(Yes / No)"];
                let dateObject2 = new Date(item["PMJAY Enrollment Date"]);
                let PMJAYEDate13 = isNaN(dateObject2.getTime()) ? ' ' : dateObject2.toLocaleDateString();
                row["PMJAY Enrollment Date"] = PMJAYEDate13;
                //row["PMJAY Enrollment Date"] = item["PMJAY Enrollment Date"];
                row["PMJAY Policy Number"] = item["PMJAY Policy Number"];
                row["Member Enrolled in APY"] = item["Member Enrolled in APY Insurance(Yes/No)"];
                let dateObject3 = new Date(item["APY Enrollment Date"]);
                let APYEDate13 = isNaN(dateObject3.getTime()) ? ' ' : dateObject3.toLocaleDateString();
                row["APY Enrollment Date"] = APYEDate13;
                //row["APY Enrollment Date"] = item["APY Enrollment Date"];
                row["APY Policy Number"] = item["APY Policy Number"];
                row["Member Enrolled in Other Life Insurance(PLI/LIC/Others)"] = item["Other Life Insurance Detail (PLI/LIC/Others) (Yes/No)"];
                row["Other Insurance Name"] = item["Other Insurance"];
                let dateObject4 = new Date(item["Other  Enrollment Date"]);
                let OtherEDate13 = isNaN(dateObject4.getTime()) ? ' ' : dateObject4.toLocaleDateString();
                row["Enrollmemt Date"] = OtherEDate13;
                //row["Enrollmemt Date"] = item["Other  Enrollment Date"];
                row["Policy Number"] = item["Other Policy Number"];

                row["BFS/BMIS Confirmation(Yes/No)"] = item["BFS/BMIS Confirmation(Yes/No)"];
                row["upload in Lokos(Yes/No)"] = item["upload in Lokos"];

                return row;
            });

            const worksheet = XLSX.utils.json_to_sheet(exportData, { header: exportHeaders });
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, "Cadres Detail");
            XLSX.writeFile(workbook, "Insurance Detail.xlsx");
        });

        // edit function
        function edit(id) {
            const rowData = filteredData.find(item => item["U_ID"] === id);
            if (rowData) {
                $('#exampleModal').modal('show');
                $("#ApproveSheet").val($("#BlockforLoaddta").val())
                document.getElementById('MemberName').value = rowData["Member Name"];
                document.getElementById('MemberCode').value = rowData["Member Code"];;
                document.getElementById('SHGCode').value = rowData["SHG Code"];;
                document.getElementById('id').value = id;
                } else {
                console.log("No data found for the given UID.");
            }  
        }

        function uploadinLOkosBtn(id)
        {
            const rowData = filteredData.find(item => item["U_ID"] === id);
            if (rowData) {
                $('#exampleModal12').modal('show');
                $("#ApproveSheet12").val($("#BlockforLoaddta").val())
                document.getElementById('MemberName12').value = rowData["Member Name"];
                document.getElementById('MemberCode12').value = rowData["Member Code"];;
                document.getElementById('SHGCode12').value = rowData["SHG Code"];;
                document.getElementById('id12').value = id;
                } else {
                console.log("No data found for the given UID.");
            }  
        }

        function updatefun(uid) {
            // Assuming 'paginatedData' is your main array of all data
            const rowData = filteredData.find(item => item["U_ID"] === uid);
            if (rowData) {
                $('#UPDATEModal').modal('show');
                $("#updSheet").val($("#BlockforLoaddta").val())

                // console.log(rowData['U_ID']);
                document.getElementById('uid').value = rowData['U_ID']; 
                document.getElementById('UpdateDistrict').value = rowData["District"];
                document.getElementById('UpdateBlock').value = rowData["Block"]; 
                document.getElementById('UpdateGP').value = rowData["GP"];
                document.getElementById('UpdateVillage').value = rowData["Village"]; 
                document.getElementById('UpdateMemberName').value = rowData["Member Name"];
                document.getElementById('UpdateMemberCode').value = rowData["Member Code"];
                document.getElementById('UpdateShgName').value = rowData["SHG Name"]; 
                document.getElementById('UpdateShgCode').value = rowData["SHG Code"];  
                document.getElementById('MemberHavingSavingAcc').value = rowData["MemberHavingSavingAcc"]; 
                document.getElementById('UpdateSavingAccountName').value = rowData["Saving Bank Name"]; 
                document.getElementById('UpdateSavingAccountNumber').value = rowData["Saving Account Number"]; 
                document.getElementById('UpdateSavingBranchName').value = rowData["Saving Branch Name"];
                document.getElementById('UpdateSavingIFSCCode').value = rowData["Saving IFSC Code"];

                // insurance
                document.getElementById('MemberEnrollInInsurance').value=rowData["MemberHavingInsurance"];
                document.getElementById('UpdateEnrollPMSBY').value = rowData["Member  Enrolled in  PMSBY (Yes /No)"];
                let date1 = new Date(rowData["PMSBY Enrollment Date"]);
                let date11 = isNaN(date1.getTime()) ? '' : `${date1.getFullYear()}-${String(date1.getMonth() + 1).padStart(2, '0')}-${String(date1.getDate()).padStart(2, '0')}`;
                document.getElementById('UpdatePMSBYEnrollDate').value = date11;

                document.getElementById('PMSBYPolicyNumber').value = rowData["PMSBY Policy Number"]; 
                document.getElementById('UpdateEnrollPMJJBY').value = rowData["Member Enrolled in PMJJBY Insurance (Yes / No)"];
                let date2 = new Date(rowData["PMJJBY Enrollment Date"]);
                let date12 = isNaN(date1.getTime()) ? '' : `${date2.getFullYear()}-${String(date2.getMonth() + 1).padStart(2, '0')}-${String(date2.getDate()).padStart(2, '0')}`;
                //document.getElementById('UpdatePMJJBYEnrollDate').value = rowData["PMJJBY Enrollment Date"]; 
                document.getElementById('UpdatePMJJBYEnrollDate').value = date12; 


                document.getElementById('PMJJBYPolicyNumber').value = rowData["PMJJBY Policy Number"];
                document.getElementById('UpdateEnrollPMJAY').value = rowData["Member Enrolled in PMJAY Insurance(Yes / No)"];
                let date3 = new Date(rowData["PMJAY Enrollment Date"]);
                let date13 = isNaN(date3.getTime()) ? '' : `${date3.getFullYear()}-${String(date3.getMonth() + 1).padStart(2, '0')}-${String(date3.getDate()).padStart(2, '0')}`;
                document.getElementById('UpdatePMJAYEnrollDate').value = date13; 
                //document.getElementById('UpdatePMJAYEnrollDate').value = rowData["PMJAY Enrollment Date"]; 

                document.getElementById('PMJAYPolicyNumber').value = rowData["PMJAY Policy Number"]; 
                document.getElementById('UpdateEnrollAPY').value = rowData["Member Enrolled in APY Insurance(Yes/No)"]; 
                
                let date4 = new Date(rowData["APY Enrollment Date"]);
                let date14 = isNaN(date4.getTime()) ? '' : `${date4.getFullYear()}-${String(date4.getMonth() + 1).padStart(2, '0')}-${String(date4.getDate()).padStart(2, '0')}`;
                document.getElementById('UpdateAPYEnrollDate').value = date14;
                //document.getElementById('UpdateAPYEnrollDate').value = rowData["APY Enrollment Date"]; 
            


                document.getElementById('APYPolicyNumber').value = rowData["APY Policy Number"]; 
                document.getElementById('UpdateEnrollOtherLI').value = rowData["Other Life Insurance Detail (PLI/LIC/Others) (Yes/No)"];
                document.getElementById('UpdateOLIName').value = rowData["Other Insurance"];
                let date5 = new Date(rowData["Other  Enrollment Date"]);
                let date15 = isNaN(date5.getTime()) ? '' : `${date5.getFullYear()}-${String(date5.getMonth() + 1).padStart(2, '0')}-${String(date5.getDate()).padStart(2, '0')}`;
                document.getElementById('UpdateOLIEnrollDate').value = date15;
                //document.getElementById('UpdateOLIEnrollDate').value = rowData["Other  Enrollment Date"];
                document.getElementById('LIPolicyNumber').value = rowData["Other Policy Number"]; 
            } else {
                console.log("No data found for the given UID.");
            }
        }

        // ################# APPROVE FROM BLOCK
        const submissionForm = document.getElementById('updateForm');
        submissionForm.addEventListener('submit', async (event) => {
            weburl="https://script.google.com/macros/s/AKfycbyWrnUZj-yruT11kNlFmVbwXSBtVxx_RFobXr0JfJa0Yqqv8-m213dYrQ0QL7StGxEs/exec";
            event.preventDefault(); // Prevent the default form submission
            const formData = new FormData(submissionForm);
            try {

                $("#updatebtn").attr("disabled", true);
                const response = await fetch(weburl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}. Response: ${errorText}`);
                }
                const result = await response.json();
                if (result.success) {
                    submissionForm.reset();
                    $('#exampleModal').modal('hide');
                    $('#msg').text("Sucessfully Confirm");
                    location.reload();
                } else {
                    $('#exampleModal').modal('hide');
                    $('#msg').css('color', 'red');  //with ID
                    $('#msg').text("Failed to Confirm  Data.");
                    
                }
            } catch (error) {
                $('#exampleModal').modal('hide');
                $('#errormsg').text("Failed to Confirm  Data.");
                location.reload();
            }
        });

        //########################  UPDATE DETAILS HERE FROM FORM  ################################
        const EditForm = document.getElementById('EditForm');
        EditForm.addEventListener('submit', async (event) => {
            weburl="https://script.google.com/macros/s/AKfycbwXKConhPbDVCOPd_r1mqdpocy7bD3qO8a9op5gyx-tyQPRj7NqeNIKX103E7ppqY8V/exec";
            event.preventDefault(); // Prevent the default form submission
            const formData = new FormData(EditForm);
            try {
                $("#updatebtn").attr("disabled", true);
                const response = await fetch(weburl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}. Response: ${errorText}`);
                }
                const result = await response.json();
                if (result.success) {
                    EditForm.reset();
                    $('#UPDATEModal').modal('hide');
                    $('#msg').text("Sucessfully updated");
                    location.reload();
                } else {
                    $('#UPDATEModal').modal('hide');
                    $('#msg').css('color', 'red');  //with ID
                    $('#msg').text("Failed to Update Data.");
                }
            } catch (error) {
                $('#UPDATEModal').modal('hide');
                $('#errormsg').text("Failed to Update Data.");
            }
        });

        // ################################ upload in lokos Form   ##################################
        // updateInLokosForm
        const UpdateINlokosForm = document.getElementById('updateInLokosForm');
        UpdateINlokosForm.addEventListener('submit', async (event) => {
            weburl="https://script.google.com/macros/s/AKfycbzCmOWmisBRvyPmQqRFQ-SzQiigJzDZKoWi_fynX8Ozn1LiiwfOuIIdJBOPP-bC0UR3/exec";
            event.preventDefault(); // Prevent the default form submission
            const formData = new FormData(UpdateINlokosForm);
            try {
                $("#updatebtn").attr("disabled", true);
                const response = await fetch(weburl, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`HTTP error! Status: ${response.status} - ${response.statusText}. Response: ${errorText}`);
                }
                const result = await response.json();
                if (result.success) {
                    UpdateINlokosForm.reset();
                    $('#exampleModal12').modal('hide');
                    $('#msg').text("Sucessfully updated");
                    location.reload();
                } else {
                    $('#UPDATEModal').modal('hide');
                    $('#msg').css('color', 'red');  //with ID
                    $('#msg').text("Failed to Update Data.");
                }
            } catch (error) {
                $('#exampleModal12').modal('hide');
                $('#errormsg').text("Failed to Update Data.");
            }
        });

        // show data if selection is there
        $("#MemberEnrollInInsurance").change(function(){
            if($("#MemberEnrollInInsurance").val()=='YES')
            {
                $("#insuranceDetailrow").show();
            }
            else{
                    $("#insuranceDetailrow").hide();
            }
        });

        //Yes,No
        $("#MemberHavingSavingAcc").change(function(){
        
            if( $("#MemberHavingSavingAcc").val()=='Yes')
            {
                $("#savingAccdetailrow").show();
            }
            else{
                $("#savingAccdetailrow").hide();
            }
        });

        // Initial setup on page load
        document.addEventListener('DOMContentLoaded', () => {
            fetchData(); // Start fetching data immediately
        });
   
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</body>
</html>
